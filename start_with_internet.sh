#!/bin/bash
# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð¾Ð¼ Ñ‡ÐµÑ€ÐµÐ· Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚

echo "ðŸŒ Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð¾Ð¼ Ñ‡ÐµÑ€ÐµÐ· Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚"
echo "================================================"
echo ""

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð¾ Ð»Ð¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
if lsof -Pi :8112 -sTCP:LISTEN -t >/dev/null ; then
    echo "âš ï¸  ÐŸÐ¾Ñ€Ñ‚ 8112 ÑƒÐ¶Ðµ Ð·Ð°Ð½ÑÑ‚. ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ð¹ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ Ð¸Ð»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð¿Ð¾Ñ€Ñ‚."
    exit 1
fi

echo "ðŸ“± Ð—Ð°Ð¿ÑƒÑÐº Flutter Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð² Ñ„Ð¾Ð½Ðµ..."
flutter run -d chrome --web-hostname 0.0.0.0 --web-port=8112 > /tmp/flutter_app.log 2>&1 &
FLUTTER_PID=$!

echo "â³ ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ (10 ÑÐµÐºÑƒÐ½Ð´)..."
sleep 10

echo ""
echo "ðŸ”— Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚ÑƒÐ½Ð½ÐµÐ»Ñ Ñ‡ÐµÑ€ÐµÐ· Serveo..."
echo "ðŸ’¡ Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ URL ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¿Ð¾ÑÐ²Ð¸Ñ‚ÑÑ Ð½Ð¸Ð¶Ðµ"
echo ""

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ‚ÑƒÐ½Ð½ÐµÐ»ÑŒ Ñ‡ÐµÑ€ÐµÐ· Serveo
ssh -o StrictHostKeyChecking=no -R 80:localhost:8112 serveo.net

# ÐžÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Flutter Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸ Ð²Ñ‹Ñ…Ð¾Ð´Ðµ
echo ""
echo "ðŸ›‘ ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ..."
kill $FLUTTER_PID 2>/dev/null

