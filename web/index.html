<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="ODO.UZ - –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏ –≤ –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω–µ –∏ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ">

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="ODO.UZ">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>ODO.UZ</title>
  <link rel="manifest" href="manifest.json">

  <script>
    // The value below is injected by flutter build, do not touch.
    var serviceWorkerVersion = null;
  </script>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage-compat.js"></script>
         <script>
           // Firebase configuration
           const firebaseConfig = {
             apiKey: "AIzaSyAa8kAiaItTeaf2UTE1T2fDxV_Z57z7cjk",
             authDomain: "odo-uz-1f4d9.firebaseapp.com",
             projectId: "odo-uz-1f4d9",
             storageBucket: "odo-uz-1f4d9.firebasestorage.app",
             messagingSenderId: "747555139152",
             appId: "1:747555139152:web:7ba508c04a65dc11946b55"
           };
           // Initialize Firebase
           firebase.initializeApp(firebaseConfig);
           
           // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º service worker –¥–ª—è push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
           if ('serviceWorker' in navigator) {
             navigator.serviceWorker.register('/firebase-messaging-sw.js')
               .then((registration) => {
                 console.log('‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration.scope);
                 
                 // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç service worker (–∫–ª–∏–∫–∏ –ø–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º)
                 navigator.serviceWorker.addEventListener('message', (event) => {
                   if (event.data && event.data.type === 'notification_click') {
                     console.log('üì± –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—é:', event.data);
                     // –ù–∞–≤–∏–≥–∞—Ü–∏—è –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ —á–µ—Ä–µ–∑ Flutter
                     // –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Flutter —á–µ—Ä–µ–∑ window.postMessage
                     window.postMessage({
                       type: 'notification_click',
                       data: event.data.data,
                       url: event.data.url
                     }, '*');
                   }
                 });
               })
               .catch((error) => {
                 console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
               });
           }
         </script>
  
  <!-- This script adds the flutter initialization JS code -->
  <script src="flutter.js" defer></script>
  
  <!-- Google Maps JavaScript API - Simplified Loading -->
  <script>
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
    window.googleMapsReady = false;
    window.googleMapsLoading = false;
    window.googleMapsCallbacks = [];
    
    // –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ Google Maps API
    window.loadGoogleMapsAPI = function(onSuccess, onError) {
      // –ï—Å–ª–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω
      if (window.google && window.google.maps) {
        console.log('‚úÖ Google Maps API —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
        window.googleMapsReady = true;
        if (onSuccess) onSuccess();
        return;
      }
      
      // –ï—Å–ª–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –¥–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å
      if (window.googleMapsLoading) {
        console.log('‚è≥ Google Maps API –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –¥–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å...');
        window.googleMapsCallbacks.push({ onSuccess, onError });
        return;
      }
      
      // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
      window.googleMapsLoading = true;
      console.log('üîÑ –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É Google Maps API...');
      
      const script = document.createElement('script');
      script.async = true;
      script.defer = true;
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º callback –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
      const callbackName = 'initGoogleMaps_' + Date.now();
      window[callbackName] = function() {
        console.log('‚úÖ Google Maps API –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        window.googleMapsReady = true;
        window.googleMapsLoading = false;
        
        // –í—ã–∑—ã–≤–∞–µ–º –≤—Å–µ –∫–æ–ª–±—ç–∫–∏
        if (onSuccess) onSuccess();
        window.googleMapsCallbacks.forEach(cb => {
          if (cb.onSuccess) cb.onSuccess();
        });
        window.googleMapsCallbacks = [];
        
        // –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
        delete window[callbackName];
      };
      
      script.src = `https://maps.googleapis.com/maps/api/js?key=AIzaSyAomtM5KaHgrG95yTVN5Wirn46Qgq--yKY&libraries=places&callback=${callbackName}`;
      
      script.onerror = () => {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Google Maps API');
        window.googleMapsLoading = false;
        if (onError) onError('Failed to load Google Maps API');
        window.googleMapsCallbacks.forEach(cb => {
          if (cb.onError) cb.onError('Failed to load Google Maps API');
        });
        window.googleMapsCallbacks = [];
        delete window[callbackName];
      };
      
      document.head.appendChild(script);
    };
    
    // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ Google Maps API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('DOMContentLoaded', function() {
      // –ù–µ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ä–∞–∑—É, —Ç–æ–ª—å–∫–æ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é
      console.log('üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, Google Maps –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é');
    });
  </script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    #loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #00E676, #03A9F4);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    
    .logo {
      width: 100px;
      height: 100px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      backdrop-filter: blur(10px);
    }
    
    .logo-text {
      color: white;
      font-size: 40px;
      font-weight: 900;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .loading-text {
      color: white;
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 20px;
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    #flutter-container {
      width: 100%;
      height: 100vh;
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loading">
    <div class="logo">
      <div class="logo-text">ODO.UZ</div>
    </div>
    <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...</div>
    <div class="spinner"></div>
  </div>

  <!-- Flutter App Container -->
  <div id="flutter-container"></div>

  <script>
    window.addEventListener('load', function(ev) {
      // Download main.dart.js
      _flutter.loader.loadEntrypoint({
        serviceWorker: {
          serviceWorkerVersion: serviceWorkerVersion,
        },
        onEntrypointLoaded: function(engineInitializer) {
          engineInitializer.initializeEngine().then(function(appRunner) {
            // Hide loading screen
            document.getElementById('loading').style.display = 'none';
            
            // Start the Flutter app
            appRunner.runApp();
          });
        }
      });
    });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è API –∫–ª—é—á–∞
    function getGoogleMapsApiKey() {
      return 'AIzaSyAomtM5KaHgrG95yTVN5Wirn46Qgq--yKY';
    }
    
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ Google Maps
    window.isGoogleMapsReady = function() {
      return window.googleMapsReady && window.google && window.google.maps;
    };
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è reCAPTCHA –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    function hideRecaptcha() {
      // –°–∫—Ä—ã–≤–∞–µ–º reCAPTCHA –≤–∏–¥–∂–µ—Ç—ã
      const recaptchaElements = document.querySelectorAll('[id^="recaptcha"], .grecaptcha-badge, iframe[src*="recaptcha"]');
      recaptchaElements.forEach(element => {
        if (element && element.style) {
          element.style.display = 'none';
          element.style.visibility = 'hidden';
          element.style.opacity = '0';
          element.style.position = 'absolute';
          element.style.left = '-9999px';
        }
      });
      
      // –¢–∞–∫–∂–µ —Å–∫—Ä—ã–≤–∞–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
      const recaptchaContainers = document.querySelectorAll('div[class*="recaptcha"], div[id*="recaptcha"]');
      recaptchaContainers.forEach(container => {
        if (container && container.style) {
          const hasRecaptcha = container.querySelector('iframe[src*="recaptcha"]');
          if (hasRecaptcha) {
            container.style.display = 'none';
            container.style.visibility = 'hidden';
          }
        }
      });
      
      // reCAPTCHA —Å–∫—Ä—ã—Ç (–±–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
    }
    
    // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Firebase
    if (typeof firebase !== 'undefined' && firebase.auth) {
      firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
          // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω - —Å–∫—Ä—ã–≤–∞–µ–º reCAPTCHA
          setTimeout(hideRecaptcha, 1000); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏
          // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, —Å–∫—Ä—ã–≤–∞–µ–º reCAPTCHA (–±–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
        }
      });
    }
    
    // –¢–∞–∫–∂–µ —Å–∫—Ä—ã–≤–∞–µ–º reCAPTCHA –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ —Å–æ–±—ã—Ç–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ)
    let lastUrl = location.href;
    new MutationObserver(() => {
      const url = location.href;
      if (url !== lastUrl) {
        lastUrl = url;
        // –ï—Å–ª–∏ –º—ã –Ω–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, —Å–∫—Ä—ã–≤–∞–µ–º reCAPTCHA
        if (!url.includes('/auth/phone') && !url.includes('/auth/sms')) {
          setTimeout(hideRecaptcha, 500);
        }
      }
    }).observe(document, { subtree: true, childList: true });
    
    // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏ —Å–∫—Ä—ã–≤–∞–µ–º reCAPTCHA (fallback)
    setInterval(function() {
      // –°–∫—Ä—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
      if (typeof firebase !== 'undefined' && firebase.auth) {
        firebase.auth().onAuthStateChanged(function(user) {
          if (user && !location.href.includes('/auth/')) {
            hideRecaptcha();
          }
        });
      }
    }, 2000);
  </script>
  
  <style>
    /* –°–∫—Ä—ã–≤–∞–µ–º reCAPTCHA –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
    body:not([data-page*="auth"]) [id^="recaptcha"],
    body:not([data-page*="auth"]) .grecaptcha-badge,
    body:not([data-page*="auth"]) iframe[src*="recaptcha"] {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
      position: absolute !important;
      left: -9999px !important;
    }
  </style>
</body>
</html>